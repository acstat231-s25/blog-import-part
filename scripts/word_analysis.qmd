---
title: "Preparing Word Analysis"
author: "Tiffany Sun"
date: "2025-04-24"
format: html
---

The purpose of this file is to...

```{r}
#| label: setup
#| include: false

knitr::opts_chunk$set(eval = FALSE, message = FALSE)

# improve digit and NA display 
options(scipen = 1, knitr.kable.NA = '')

# load packages
library(tidyverse)
library(readr)
library(purrr)
library(tidytext)
library(wordcloud)
library(textdata)
library(wordcloud2)
library(ggiraph)
```

```{r}
#| label: read-files

# read clean game data 
games_data <- readRDS("../data/processed/clean_games.rds")

games_description <- games_data |>
  select(name, about_the_game) |>
  mutate(
    about_the_game = str_replace_all(about_the_game, "[:digit:]", "")
  )

```

```{r}
#| label: word-analysis-prep
afinn_lexicon <- get_sentiments("afinn")

total_games_words <- games_description |>
  unnest_tokens(output = word, input = about_the_game) |>
  anti_join(stop_words, by = "word") |>
  count(word, sort = TRUE) 

total_games_words <-
   mutate(
    left_join(total_games_words, afinn_lexicon)
  ) |>
  na.omit()

grouped_games_words <- games_description |>
  unnest_tokens(output = word, input = about_the_game) |>
  anti_join(stop_words, by = "word") |>
  group_by(name) |>
  count(word, sort = TRUE)

grouped_games_words <- 
  mutate(
    left_join(grouped_games_words, afinn_lexicon)
  ) |>
  na.omit()

grouped_games_words |>
  slice(1:10)

total_games_words |>
  slice(1:10)

```

```{r}
set.seed(2025)

# Create word cloud using tidyverse

pal <- brewer.pal(9, "Blues")

set.seed(2024)

game_words |>
  with(wordcloud(
    words = word, 
    freq = n,
    min.freq = 2,
    max.words = 15,
    random.order = TRUE,
    scale = c(2, 1.75),
    rot.per = 0.3,
    colors = pal,
    family = "serif"
  ))


total_games_words |>
  select(word, n) |>
  letterCloud(word = "PEACE", color="white", backgroundColor="pink")

letterCloud( demoFreq, word = "PEACE", color="white", backgroundColor="pink")




```

```{R}
#| label: afinn sentiment analysis

p <- ggplot(game_word_freqs, 
       aes(x = reorder(word, value), value),
       label = value, 
       tooltip = value) + 
  geom_bar_interactive(stat = "identity", aes(fill = value), show.legend = FALSE, color = "darkgrey") + 
  coord_flip() +
  labs(
    title = "Sentiment Analysis of Words",
    subtitle = "Some words are excluded due to not having any sentiment value",
    y = "Value",
    x = "Word"
  ) +
  scale_fill_gradient2(low = "#046E94",
                       mid = "aliceblue",
                       high = "#FFDE21") +
  theme_minimal()


interactive_plot <- girafe(ggobj = p)

interactive_plot

  

```

```{R}
#| label: circular diagram
circle <-
  ggplot(game_word_freqs, aes(word, abs(value))) + 
  geom_bar(stat = "identity", aes(fill = value), show.legend = FALSE, color = "darkgrey") + 
  ylim(-1,4) +
  scale_fill_gradient2(low = "#046E94",
                       mid = "aliceblue",
                       high = "#FFDE21") +
  coord_polar(start = 0) +
  theme_minimal() +
  theme(
    panel.grid = element_blank(),
    axis.text = element_blank(),
    plot.margin = unit(rep(-1,4), "cm")) +
  labs(
    title = "Hi"
  ) +
   geom_text(
     data=game_word_freqs, 
     aes(x=word, y=value+10, label = word), 
     color="black", 
     fontface="bold",
     alpha=0.6, 
     size=2.5
     ) 
 
  

circle


```

```{r}
#| label: saving-data

# data used for cluster analysis
saveRDS(grouped_games_words, file = "../data/processed/grouped_word_data.RDS")
saveRDS(total_games_words, file = "../data/processed/total_word_data.RDS")

```
