---
title: "Preparing Word Analysis"
author: "Tiffany Sun"
date: "2025-04-24"
format: html
---

The purpose of this file is to wrangle the dataset to prepare for word analysis.
Here I have created two datasets: one that enables analysis at a bigger picture
ana another that enables analysis per game. 

```{r}
#| label: setup
#| include: false

knitr::opts_chunk$set(eval = FALSE, message = FALSE)

# improve digit and NA display 
options(scipen = 1, knitr.kable.NA = '')

# load packages
library(tidyverse)
library(tidytext)
library(parsedate)

```

```{r}
#| label: read-files

# read clean game data 
games_data <- readRDS("../data/processed/clean_games.rds")


games_data <- games_data |>
mutate(release_date = parse_date(release_date),
       year = year(release_date))

# Removed numeric values 
games_description <- games_data |>
  select(name, about_the_game, year) |>
  mutate(
    about_the_game = str_replace_all(about_the_game, "[:digit:]", "")
  )

```

```{r}
#| label: word-analysis-prep


#Retrieve AFINN dataset
afinn_lexicon <- get_sentiments("afinn")

# Creating a word dataset that allows analysis as a whole
# Has variables: name, word, n (count)
total_games_words <- games_description |>
  unnest_tokens(output = word, input = about_the_game) |>
  anti_join(stop_words, by = "word") |>
  count(word, sort = TRUE) 

# Added to include sentiment values per word
total_games_words <-
   mutate(
    left_join(total_games_words, afinn_lexicon)
  ) |>
  na.omit()

# Creating a word dataset that allows analysis per game
# Has variables: name, word, n (count)
grouped_games_words <- games_description |>
  unnest_tokens(output = word, input = about_the_game) |>
  anti_join(stop_words, by = "word") |>
  group_by(name) |>
  count(word, sort = TRUE) 

# Added to include sentiment values per word. This will cause exclusion of more words
grouped_games_sentiments <- 
  mutate(
    left_join(grouped_games_words, afinn_lexicon)
  ) |>
  na.omit()

sentimentvstime <- games_description |>
  unnest_tokens(output = word, input = about_the_game) |>
  anti_join(stop_words, by = "word") |>
  group_by(year) |>
  count(word, sort = TRUE)

sentimentvstime <- 
   mutate(
    left_join(sentimentvstime, afinn_lexicon)
  ) |>
  na.omit()

# See if they work
grouped_games_words |>
  slice(1:10)

total_games_words |>
  slice(1:10)

```



```{r}
#| label: saving-data

# data used for word analysis
saveRDS(total_games_words, file = "../data/processed/total_games_words.RDS")
saveRDS(sentimentvstime, file = "../data/processed/sentiment_vs_time.RDS")
saveRDS(grouped_games_words, file = "../data/processed/grouped_games_words.RDS")
saveRDS(grouped_games_sentiments, file = "../data/processed/grouped_games_sentiments.RDS")
```
