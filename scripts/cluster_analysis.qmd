---
title: "Preparing Cluster Analysis"
author: "John Lim"
date: "2025-04-24"
format: pdf
---

The purpose of this file is to explore how different games on Steam can be grouped. What makes games alike/unalike?

```{r}
#| label: setup
#| include: false

knitr::opts_chunk$set(eval = FALSE, message = FALSE)

# improve digit and NA display 
options(scipen = 1, knitr.kable.NA = '')

# load packages
library(tidyverse)
library(readr)
library(purrr)
library(broom)
library(ggrepel)
library(GGally)
```

```{r}
#| label: read-files

# read clean game data 
game_data <- readRDS("../data/processed/clean_games.rds")

```

```{r}
#| label: cluster-prep

# get net rating
game_data2 <- game_data |>
  mutate(net_review = positive + negative)

# get quantitative variables that I want to use for clustering
game_quant <- game_data2 |>
  select(required_age, price, dlc_count, metacritic_score,
         achievements, recommendations,
         median_playtime_forever, peak_ccu, net_review) |>
  drop_na()

# glimpse(game_quant)

# standardize variables for clustering
game_standardized <- game_quant |>
  mutate(across(everything(),
                ~ (.x - mean(.x)) / sd(.x),
                .names = "{.col}_z")) |>
  select(ends_with("_z"))

```

```{r}
#| label: elbow-plot

# set seed for reproducibility
set.seed(42069777)

# iterate through clustering algorithm for 10 different values of k
elbow_plot <- tibble(k = 1:10) |>
  mutate(
    kmeans_results = purrr::map(k, ~ kmeans(game_standardized, .x, nstart=25)),
    glanced = purrr::map(kmeans_results, glance)) |>
  unnest(cols = c(glanced))

# construct elbow plot
ggplot(elbow_plot, aes(x = k, y = tot.withinss)) +
  geom_point() + 
  geom_line() +
  scale_x_continuous(breaks = 1:10) +
  labs(x = "Number of clusters (k)", 
       y = "Total within-cluster sum of squares")
```

```{r}
#| label: fit-cluster

# 5 clusters appear to be the best

```


```{r}
#| label: saving-data

# data used for cluster analysis
saveRDS(*******, file = "../data/processed/cluster_data.RDS")

```


