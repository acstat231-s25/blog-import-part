---
title: "Preparing Network Analysis"
author: "Surya Rao"
date: "2025-04-24"
format: pdf
---

The purpose of this file is to...

```{r}
#| label: setup
#| include: false

knitr::opts_chunk$set(eval = FALSE, message = FALSE)

# improve digit and NA display 
options(scipen = 1, knitr.kable.NA = '')

# load packages
library(tidyverse)
library(readr)
library(purrr)
library(ggraph)
library(ggiraph)
library(plotly)


```

```{r}
#| label: read-files

# read clean game data 
game_data <- readRDS("../data/processed/clean_games.rds")

```

```{r}
#| label: network-prep
game_data <- game_data |> arrange(desc(metacritic_score))
short_game_data <- game_data |> slice_head(n = 40) 
short_game_data <- short_game_data |> mutate(isFree = case_when(price == 0 ~ TRUE,
                                                                .default = FALSE))
short_game_data <- short_game_data |> mutate(AdultOnly = case_when(required_age > 17 ~ TRUE,
                                                                .default = FALSE))
short_game_data <- short_game_data |> mutate(AdultOnly = case_when(required_age >= 17 ~ TRUE,
                                                                .default = FALSE))
short_game_data <- short_game_data |> mutate(GreatSteamReview = case_when((positive/(positive + negative)) >= .95 ~ TRUE, .default = FALSE))

short_game_data <- short_game_data |> mutate(categories1 =  strsplit(categories, ", "))
short_game_data <- short_game_data |> mutate(genres1 =  strsplit(genres, ", "))

betterformat <- short_game_data |> unnest_longer(tags) 
simpleformat <- betterformat |> select(name,tags_id)
edges <- simpleformat |> full_join(simpleformat,simpleformat, by = join_by(tags_id == tags_id))
V <- short_game_data |> select(name, isFree, AdultOnly,GreatSteamReview)
edges <-edges |> filter(name.x != name.y)
E <- edges |> mutate(from = name.x) |> mutate(to = name.y) |> group_by(from,to) |> summarize(n = n(), tags = list(tags_id))
g <- tbl_graph(nodes = V, directed = FALSE, edges = E)
g
```


```{r}
degreegraph <-  g |> 
  activate(nodes) |> 
  mutate(weighted_degree = centrality_degree(mode = "total", weights = n)) 

g<- ggraph(degreegraph, 'drl') +
  scale_size(range = c(1,10)) +
  geom_edge_link(aes(width = n, edge_colour = n), alpha = 0.25) + 
  scale_edge_width(range = c(.5, 2)) +
  geom_node_label(aes(label = name, fill = weighted_degree), size = 2, repel = TRUE) +
  scale_edge_color_gradientn(colours = c("yellow2", "green4", "blue")) +
  scale_fill_gradientn(colours = c("red", "white", "blue")) +
  geom_node_point(color = "dodgerblue") + 
  theme_void() + labs(
    title = "Top 40 Highest Rated Games Network",
    edge_color = "Total number of Shared Tags",
    edge_width = "Total number of Shared Tags",
    fill = "Weighted Degree", 
    repel = TRUE
  )
girafe(ggobj = g)

```


```{r}
#| label: saving-data

# data used for cluster analysis
saveRDS(*********, file = "../data/processed/network_data.RDS")

```


